# ⚙️ Configuration with Ansible

## 🎯 Objective

Configure all provisioned infrastructure using modular Ansible roles executed via SSM. Ensure reproducibility, traceability, and audit-ready routines for QA and Production. Integrate CloudWatch monitoring and consume Terraform outputs dynamically.

---

## 🧱 1. Role-Based Architecture

Each component is configured via a dedicated Ansible role:

### ✅ `bastion/`
- Installs Ansible and AWS CLI
- Prepares control node for SSM-based orchestration
- No SSH keys required

### ✅ `common/`
- Updates package cache
- Installs base packages (curl, unzip, git, netcat, python3-pip)
- Applied to all EC2 instances

### ✅ `frontend/`
- Deploys app from `/opt/devops-rampup/movie-analyst-ui/`
- Configures service and permissions
- Starts service via systemd

### ✅ `backend/`
- Deploys app from `/opt/devops-rampup/movie-analyst-api/`
- Configures RDS connection using `group_vars/all.yml`
- Uses Jinja2 template for `db.conf`
- Starts service via systemd

### ✅ `database/`
- Validates RDS connectivity via `nc`
- Optional initialization tasks

### ✅ `monitoring/`
- Installs CloudWatch Agent
- Places JSON config for metrics and logs
- Starts agent service

---

## 🧪 2. Execution Flow

```bash
cd ../../../ansible/scripts/
./generate_inventory.sh
./generate_group_vars.sh
cd ..
source .venv/bin/activate
pip install ansible==9.7.0
ansible all -i inventory/hosts.ini -m ping
ansible -i inventory/hosts.ini bastion -m command -a "echo hello" -vvv
ansible-playbook -i inventory/hosts.ini playbooks/site.yml
```
### 🧹 3. Environment Teardown
To destroy all resources in a given workspace:
```bash
cd ../terraform/environments/qa
terraform workspace select qa   # or prod
terraform destroy
aws s3 rm s3://terraform-state-bucket-felipe-99009900 --recursive
aws cloudformation delete-stack \
  --stack-name terraform-backend-bootstrap \
  --region us-east-1
aws cloudformation describe-stacks \
  --stack-name terraform-backend-bootstrap \
  --region us-east-1
```
📌 Notes
All roles are modular and reusable across environments

Backend and database reside in private subnets; bastion orchestrates via SSM

CloudWatch Agent config is stored in roles/monitoring/files/cloudwatch-config.json

db.conf.j2 uses variables from group_vars/all.yml

Artefact paths are /opt/devops-rampup/... (cloned via user_data)

All tasks are idempotent and audit-friendly
